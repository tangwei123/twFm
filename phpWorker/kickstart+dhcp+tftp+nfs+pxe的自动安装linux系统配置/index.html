工作目的：自动为IP为192.168.6.109的服务器安装centos操作系统
    工作准备 :
            关掉所有工作机的防火墙和selinux

            192.168.6.105为DHCP服务器
            192.168.6.106为tftp服务器
            192.168.6.107为nfs服务器
    工作原理：
                192.168.6.109目标机器，从105的DHCP服务器上拉取IP地址、tftp地址以及prelinux.0文件的位置，有了prelinux.0文件（相当于grub文件）
            就需要从105上拉取prelinux.cfg/default文件（具体的文件加载顺序）、vmlinuz文件、initrd.img文件。在prelinux.cfg/default文件中，
            设定了需要安装系统的配置文件为在107服务器上的ks.cfg文件、该文件就是设定新装系统的一些默认参数。

    开始配置工作：
            一、配置105的DHCP服务器：

                1、yum install dhcp* -y 安装dhcp服务

                2、修改/etc/dhch/dhcpd.conf文件：
                        ddns-update-style interim;          # 设置DNS的动态更新类型，style参数必须是：ad-hoc、interim 或者 none

                        ignore client-updates;              # 不允许动态更新DNS，允许的话是allow

                        allow booting;                      # 是否响应使用者查询，定义能够PXE启动

                        allow bootp;                        # 是否响应激活查询，定义支持bootp

                        next-server 192.168.0.20;                                   # TFTP服务器IP地址

                        filename "/pxelinux.0";                                      # 注意此行的位置，如果写在subnet下面的话，安装会失败。

                        subnet 192.168.0.0 netmask 255.255.255.0 {                # 定义子网

                            option routers                  192.168.0.1;         # 为客户端提供的网关地址

                            option subnet-mask              255.255.255.0;      # 为客户端设定子网掩码

                            option time-offset              -18111; # Eastern Standard Time   # 为客户端设定与格林威治时间的偏移时间，单位是秒。

                            #       option ntp-servers              192.168.0.1;                         # 为客户端设定网络时间服务器IP地址

                            #       option netbios-name-servers     192.168.0.1;

                            # --- Selects point-to-point node (default is hybrid). Don't change this unless

                            # -- you understand Netbios very well

                            #       option netbios-node-type 2;

                            range dynamic-bootp 192.168.0.128 192.168.0.254;   # DHCP服务器为 Client 分配的地址范围

                            default-lease-time 21611;                              # 默认地址租约过期时间，全局选项

                            max-lease-time 43211;                                   # 地址租约最长过期时间，全局选项
                        }

                3、启动dhcp服务

                    systemctl start dhcpd

                4、测试dhcp服务器是否正常工作
                    tar -f /var/log/messages 日志中的信息

            二、配置106的tftp服务器：

                1、安装syslinux服务：
                        yum install syslinux* -y

                2、找到prelinux.0文件，并将其复制到稍后安装的tftp的下载根目录里面去（一般在tftp配置文件中的server_args参数设置的）

                3、安装tftp服务：

                        yum install tftp* -y

                4、启动tftp：
                        修改/etc/xinetd.d/tftp 把其中的disable 改为 no即可

                5、把linux光盘上的vmlinuz、inited.img文件复制到tftp的下载根目录里面去（具体复制过程centos7和centos6有区别）

                6、到tftp的下载根目录中，创建文件夹pxelinux.cfg文件夹，然后在该文件夹中创建default文件，添加内容为：
                        label default #“label”指定你在“boot:”提示符下输入的关键字。比如：boot: linux[ENTER] 这个会启动“label linux”下标记的 kernel 和 initrd.img 文件。
                        kernel vmlinuz
                        append ks=nfs:192.168.6.107:/newdisk/ks.cfg initrd=initrd.img  # 指定 ks.cfg 配置文件的位置

                7、测试tftp的是否正常工作
                        tftp 192.168.6.107
                        get vmlinuz即可

            三、配置107的nfs服务器：
                1、安装nfs服务
                    yum install nfs* -y

                2、修改nfs的配置文件将某一个目录共享出去 共享的配置，只需要在/etc/exports中添加：/xxx/xxx/xx IP (rw, sync)即可

                3、将光盘上所有的东西复制到共享目录

                4、启动nfs服务

                5、怎么测试nfs是否成功
                    mount -t nfs 192.168.6.107:/newdisk /test 测试下看看能不能挂载

            四、安装配置kickstart服务：

                    只需事先定义好一个Kickstart自动应答配置文件ks.cfg（通常存放在安装服务器上，但是安装服务器现在是空的什么都没有，所以一般都放在nfs服务器上），
                并让安装程序知道该配置文件的位置，在安装过程中安装程序就可以自己从该文件中读取安装配置，这样就避免了繁琐的人机交互，实现无人值守的自动化安装

                    如果你希望实现和某系统类似的安装，可以基于该系统的kickstart配置文件来生成你自己的kickstart配置文件。 该文件位于：/root/anaconda-ks.cfg
                即 cp /root/anaconda-ks.cfg /xxx/xxx/xx/ks.cfg

                    ks.cfg文件内容概述：
                            install
                            #cdrom
                            nfs --server=192.168.6.128 --dir=/newdisk   #这个选项告诉安装程序：到服务器192.168.6.107的NFS共享目录 /newdisk下寻找安装介质
                            lang en_US.UTF-8
                            keyboard us
                            #network --device eth0 --bootproto static --ip 192.168.1.101 --netmask 255.255.255.0 --gateway 192.168.1.1 --nameserver 202.106.0.20 --hostname centos5 这个不需要
                            #network --device eth0 --bootproto dhcp
                            rootpw --iscrypted $6$juYf15j5uas0ZxNC$eVAvPJkdTZJ8BpVC1vdhXFOwuTSf77kg9Ha.v2i6b4n52QdtH01U5Itt50wr98fPoVAmaeb6oye9Q7bKrzA6D.  # 密码为 123456
                            firewall --disable      # 启用防火墙，并且允许 22 号端口通过防火墙
                            firstboot --disable                    #决定是否在系统第一次引导时启动"设置代理".如果启用,firstboot软件包必须被安装.如果不指定,这个选项是缺省为禁用的.
                            authconfig --enableshadow --enablemd5
                            selinux --disabled                     # 强制启用 selinux，如果不需要可以改成 disabled
                            timezone --utc Asia/Shanghai
                            bootloader --location=mbr --driveorder=sda --password=$1$3xvzZgwz$1jYjrh/XtXLblT00Mn3Ys0  # grub 密码为 123456
                            # The following is the partition information you requested
                            # Note that any partitions you deleted are not expressed
                            # here so unless you clear all partitions first, this is
                            # not guaranteed to work
                            clearpart --all --initlabel           # 如果ks.cfg脚本中不添加该语句，将不能实现自动化安装。
                            text                                      # 使用文本方式安装
                            part /boot --fstype ext3 --size=200 --asprimary
                            part swap --size=512 --asprimary
                            part / --fstype ext3 --size=1 --grow --asprimary
                            %packages
                            @base
                            @core
                            @development-libs
                            @development-tools
                            @editors
                            @system-tools
                            @x-software-development
                            keyutils
                            trousers
                            fipscheck
                            device-mapper-multipath
                            imake
                            audit
                            mesa-libGLU-devel
                            %end